# ブログサービス 要件定義書

## 1. 概要

本システムは、Laravel 12（PHP 8.5）を使用して開発するブログサービスである。  
非登録ユーザは記事の閲覧・検索が可能であり、登録ユーザは記事の投稿・編集・削除・コメント・お気に入り登録・タグ付け機能を利用できる。  
開発環境は Laravel Sail および Docker により構築する。

---

## 2. システム構成

| 項目 | 内容 |
|------|------|
| フレームワーク | Laravel 12 |
| 言語 | PHP 8.5 |
| テンプレートエンジン | Blade |
| 環境構築 | Laravel Sail, Docker |
| データベース | MySQL (想定) |
| フロントエンド | Blade + CSS（TailwindまたはBootstrap想定） |

---

## 2.1 アーキテクチャ方針

- **UseCaseパターンの採用**
  - Controllerにビジネスロジックを記述しない
  - 業務処理はUseCaseクラスに集約する
  - 1つのUseCaseは1つの業務処理のみを担当する
- **レイヤ構成**
  - Controller: HTTPリクエスト/レスポンスの変換のみ
  - UseCase: 業務ロジックの実装
  - Model: データ構造とリレーション定義のみ
- **DDDは採用しない** - シンプルな構成を維持

---

## 3. ユーザ種別と機能一覧

| 機能 | 非登録ユーザ | 登録ユーザ |
|------|---------------|-------------|
| 記事閲覧 | ○ | ○ |
| 記事検索 | ○ | ○ |
| 新規登録／ログイン | × | ○ |
| 記事投稿 | × | ○ |
| 記事編集／削除 | × | ○（自身の記事のみ） |
| コメント投稿 | × | ○ |
| お気に入り登録 | × | ○ |
| タグ付け | × | ○（自身の記事のみ） |

---

## 4. 機能要件

### 4.1 認証機能
- ユーザ登録（メールアドレス・パスワード）
- ログイン／ログアウト
- パスワードリセット（メール送信）
- **メール認証（オプション）**

### 4.2 記事管理機能
- 記事一覧表示（新着順・人気順・ページネーション対応）
- 記事詳細表示
- 記事作成（タイトル・本文・タグ入力）
- 記事編集・削除（投稿者本人のみ - **認可チェック必須**）
- タグによる分類とフィルタリング
- **下書き保存機能**

### 4.3 検索機能
- 記事タイトル・本文・タグによる検索
- キーワード検索フォームを設置
- **検索結果のページネーション**

### 4.4 コメント機能
- 各記事に対してコメント投稿可能
- 投稿者名・本文・投稿日時の表示
- コメント削除（投稿者本人または**記事投稿者**）
- **コメント編集機能（投稿者本人のみ）**

### 4.5 お気に入り機能
- 各記事に「お気に入り」ボタン設置
- 自分のお気に入り一覧を表示可能
- **お気に入り数の表示**

---

## 5. 非機能要件

| 項目 | 内容 |
|------|------|
| パフォーマンス | 通常アクセス時に1秒以内の応答、N+1問題の回避 |
| セキュリティ | Laravel標準のCSRF、XSS対策、SQLインジェクション対策を利用<br>**認可チェック（Policy）の徹底**<br>**パスワードはbcryptでハッシュ化** |
| 可用性 | Docker環境で容易に再構築可能 |
| 拡張性 | API化を想定した設計（将来のSPA対応を考慮） |
| 保守性 | **PSR-12準拠、UseCaseパターンによる責務分離** |

---

## 6. 画面構成（想定）

| 画面名 | 概要 |
|--------|------|
| トップページ | 記事一覧、新着記事の表示 |
| 記事詳細ページ | 記事本文、コメント欄表示 |
| 記事投稿ページ | タイトル・本文・タグ入力フォーム |
| 記事編集ページ | 既存記事の編集フォーム |
| ログインページ | メール・パスワード入力 |
| ユーザ登録ページ | ユーザ登録フォーム |
| マイページ | 投稿記事一覧・お気に入り一覧 |

---

## 7. データベース設計（概要）

| テーブル名 | 主なカラム | 説明 |
|-------------|-------------|------|
| users | id, name, email, email_verified_at, password, remember_token, created_at, updated_at | ユーザ情報 |
| posts | id, user_id, title, body, **status (published/draft)**, **view_count**, created_at, updated_at, **deleted_at** | 記事情報（論理削除対応） |
| comments | id, post_id, user_id, body, created_at, updated_at, **deleted_at** | コメント情報（論理削除対応） |
| favorites | id, post_id, user_id, created_at | お気に入り情報（**ユニーク制約: post_id + user_id**） |
| tags | id, name, **slug**, created_at, updated_at | タグマスタ |
| post_tag | post_id, tag_id | 記事とタグのリレーション（**複合主キー**） |

### インデックス設計
- posts: user_id, status, created_at, view_count
- comments: post_id, user_id
- favorites: post_id, user_id（ユニーク）
- tags: slug（ユニーク）

---

## 8. 開発環境構築手順（概要）

1. Docker と Laravel Sail のインストール  
2. `sail up -d` により開発環境を起動  
3. `.env` ファイルの設定（DB接続など）  
4. `sail artisan migrate` によりDBマイグレーション実行  
5. **`sail artisan db:seed` によりテストデータ投入**
6. `sail artisan serve` でローカル起動確認  

---

## 9. セキュリティ要件（詳細）

### 9.1 認証
- Laravel Sanctum または Fortify を使用
- セッション管理の徹底

### 9.2 認可
- **Laravel Policy による権限チェック**
  - 記事編集・削除: 投稿者本人のみ
  - コメント削除: コメント投稿者または記事投稿者
- **Gate による管理者権限チェック（将来対応）**

### 9.3 バリデーション
- FormRequest による入力検証の徹底
- XSS対策（Blade自動エスケープ）
- SQLインジェクション対策（Eloquent使用）

---

## 10. 今後の拡張予定（任意）

- 管理者用ダッシュボード  
- 記事のアクセス数集計  
- 画像アップロード機能  
- 通知機能（コメント・お気に入りなど）
- **REST API の提供（JSON レスポンス）**
- **全文検索エンジン（Laravel Scout + Meilisearch）**

---

## 11. 想定スケジュール（例）

<!-- | フェーズ | 内容 | 期間 |
|-----------|--------|------|
| 設計 | 要件定義・DB設計・画面設計 | 1週間 |
| 実装 | 各機能の実装とBlade作成 | 2週間 |
| テスト | 単体・結合テスト | 1週間 |
| デプロイ | Dockerコンテナ構築・本番環境反映 | 1週間 | -->

---

## 12. 備考
- シンプルな構成を優先し、初期リリースでは最小限の機能に留める。  
- Laravel標準機能（Auth、Eloquent、Blade）を最大限活用する。
- **コーディング規約は PSR-12 に準拠し、GitHub Copilot カスタム指示に従う。**
- **テストコード（Feature Test）は主要機能に対して作成する。**
